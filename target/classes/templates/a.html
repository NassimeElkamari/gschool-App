<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
  <meta charset="UTF-8">
  <title>Tableau de Bord</title>
  <!-- Include Bootstrap for styling -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" />
  <!-- Include Highcharts library for charting -->
  <script src="https://code.highcharts.com/highcharts.js"></script>
  <script src="https://code.highcharts.com/modules/exporting.js"></script>
  <!-- Include jQuery -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <!-- Include Bootstrap JS -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <!-- Include Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <!-- Include Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    /* Global Styles */
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #eef2ff, #d1d5db);
      color: #2d3748;
      margin: 0;
      padding: 0;
    }

    /* Sidebar */
    .sidebar {
      position: fixed;
      top: 100px;
      left: 20px;
      width: 250px;
      height: calc(100vh - 100px);
      padding: 20px;
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .sidebar ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .sidebar li {
      margin-bottom: 15px;
    }

    .sidebar a {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px;
      color: #4a5568;
      text-decoration: none;
      border-radius: 10px;
      transition: all 0.3s ease;
    }

    .sidebar a:hover {
      background: rgba(203, 213, 224, 0.3);
      transform: translateX(10px);
    }

    .sidebar a.active {
      background: linear-gradient(135deg, #4f46e5, #6d28d9);
      color: white;
      font-weight: bold;
    }

    /* Header */
    .header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      padding: 20px 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 1000;
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(10px);
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .header .user-info {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 16px;
    }

    /* Main Content */
    .main-content {
      margin-left: 300px;
      margin-top: 100px;
      padding: 30px;
      background: white;
      border-radius: 20px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      animation: fadeIn 1s ease-in-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Big Title */
    .big-title {
      font-size: 32px;
      font-weight: bold;
      text-align: center;
      margin-bottom: 30px;
      color: #4f46e5;
    }

    /* Cards */
    .cards-container {
      display: flex;
      justify-content: space-between;
      gap: 20px;
      margin-bottom: 30px;
    }

    .card {
      flex: 1;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      text-align: center;
      transition: transform 0.3s;
    }

    .card:hover {
      transform: scale(1.05);
    }

    .card h3 {
      font-size: 18px;
      margin-bottom: 10px;
    }

    .card p {
      font-size: 24px;
      font-weight: bold;
      color: #4f46e5;
    }

    /* Chart Container */
    .charts-container {
      display: flex;
      justify-content: space-between;
      gap: 20px;
      margin-top: 50px;
    }

    #columnChart {
      width: 50%;
      height: 300px;
    }

    #ageChart {
      width: 50%;
      height: 400px;
    }
  </style>
</head>
<body>

<!-- Header -->
<div class="header">
  <div class="user-info">
    <i class="fas fa-user-circle text-xl"></i>
    <span th:text="${userName}">Utilisateur</span>
  </div>
  <a href="#" class="btn btn-primary">D√©connexion</a>
</div>

<aside class="sidebar">
  <ul>
    <li>
      <a th:href="@{/}" th:classappend="${currentPage == 'home'} ? 'active'">üè† Accueil</a>
    </li>
    <li>
      <a th:href="@{/dashboard}" th:classappend="${currentPage == 'statistiques'} ? 'active'">üìä Statistiques</a>
    </li>
    <li>
      <a th:href="@{/filieres}" th:classappend="${currentPage == 'filieres'} ? 'active'">üìö Fili√®res</a>
    </li>
    <li>
      <a th:href="@{/etudiants}" th:classappend="${currentPage == 'etudiants'} ? 'active'">üë®‚Äçüéì √âtudiants</a>
    </li>
    <li>
      <a th:href="@{/utilisateurs}" th:classappend="${currentPage == 'utilisateurs'} ? 'active'">üë• Utilisateurs</a>
    </li>
  </ul>
</aside>

<!-- Main Content -->
<div class="main-content">
  <!-- Big Title -->
  <h1 class="big-title">Tableau de Bord de Gestion Scolaire</h1>

  <!-- Cards -->
  <div class="cards-container">
    <div class="card">
      <h3>√âtudiants</h3>
      <p th:text="${etudiantCount}">0</p>
    </div>
    <div class="card">
      <h3>Fili√®res</h3>
      <p th:text="${filiereCount}">0</p>
    </div>
    <div class="card">
      <h3>Utilisateurs</h3>
      <p th:text="${utilisateurCount}">0</p>
    </div>
  </div>

  <!-- Charts -->
  <div class="charts-container">
    <!-- Column Chart Container -->
    <div id="columnChart"></div>

    <!-- Pie Chart Container -->
    <div id="ageChart"></div>
  </div>

  <!-- Thymeleaf Template: Inline JavaScript -->
  <script th:inline="javascript">
    // Dataset 1: Student distribution by filiere
    var filieres = /*[[${filieres}]]*/ [];
    var nombreEtudiants = /*[[${nombreEtudiants}]]*/ [];

    // Dataset 2: Student age distribution
    var ageGroups = /*[[${ageGroups}]]*/ [];
    var ageCounts = /*[[${ageCounts}]]*/ [];

    // Column Chart (Student Distribution by Filiere)
    Highcharts.chart('columnChart', {
      chart: {
        type: 'column',
        width: 600,
        height: 300
      },
      title: {
        text: 'R√©partition des √âtudiants par Fili√®re',
        style: {
          fontSize: '24px' // Increase title font size
        }
      },
      xAxis: {
        categories: filieres,
        crosshair: true,
        labels: {
          style: {
            fontSize: '18px' // Increase X-axis label font size
          }
        }
      },
      yAxis: {
        min: 0,
        title: {
          text: 'Nombre d\'√âtudiants',
          style: {
            fontSize: '18px' // Increase Y-axis title font size
          }
        },
        labels: {
          style: {
            fontSize: '18px' // Increase Y-axis label font size
          }
        }
      },
      tooltip: {
        headerFormat: '<span style="font-size: 18px">{point.key}</span><table>', // Increase tooltip header font size
        pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
                '<td style="padding:0"><b>{point.y}</b></td></tr>',
        footerFormat: '</table>',
        shared: true,
        useHTML: true,
        style: {
          fontSize: '18px' // Increase tooltip font size
        }
      },
      plotOptions: {
        column: {
          pointWidth: 30, // Width of the bars
          pointPadding: 0.1, // Space between bars within the same group
          groupPadding: 0.1, // Space between groups of bars
          borderWidth: 0
        }
      },
      legend: {
        itemStyle: {
          fontSize: '18px' // Increase legend font size
        }
      },
      series: [{
        name: '√âtudiants',
        data: nombreEtudiants,
      }]
    });
    // Pie Chart (Student Age Distribution)
    Highcharts.chart('ageChart', {
      chart: {
        type: 'pie',
        options3d: {
          enabled: true,
          alpha: 50,
          beta: 0
        },
        width: 600,
        height: 400
      },
      title: {
        text: 'R√©partition des √âtudiants par √Çge',
        style: {
          fontSize: '24px' // Increase title font size
        }
      },
      tooltip: {
        pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>',
        style: {
          fontSize: '18px' // Increase tooltip font size
        }
      },
      plotOptions: {
        pie: {
          allowPointSelect: true,
          cursor: 'pointer',
          depth: 35,
          dataLabels: {
            enabled: true,
            format: '{point.name} : {point.y}',
            style: {
              fontSize: '18px' // Increase data label font size
            }
          }
        }
      },
      series: [{
        type: 'pie',
        name: '√âtudiants',
        data: ageGroups.map((group, index) => [group, ageCounts[index]])
      }]
    });
  </script>
</div>

</body>
</html>